---
description: 
globs: packages/*/*.py
alwaysApply: false
---
When your action, tool, prompt or resource need a service, determine which services they need.

For each required secrets,  always add at the beginng of the file `packages/<package>/<action>/__main__.py` a comment in the form

#--param <SECRET> "$<SECRET>"

Also add in the file `packages/<package>/<action>/<action>.py` at the beginning of the `<action>` function the assignment

<SECRET> = args.get("<SECRET>", os.getenv("<SECRET>")

Add also at the to the `<action>` function the initialization code as follows.


When you need to use redis you need the following secrets:

- REDIS_URL
- REDIS_PREFIX

and this initalization code:

```
rd = redis.from_url(args.get("REDIS_URL", os.getenv("REDIS_URL")))
prefix = args.get("REDIS_PREFIX", os.getenv("REDIS_PREFIX"))
```

When you use OLLAMA you need the following secrets:
- OLLAMA_HOST
- AUTH

and this initalization code:

```
ollama = args.get("OLLAMA_HOST", os.getenv("OLLAMA_HOST"))
auth = args.get("OLLAMA_TOKEN", os.getenv("AUTH"))
llm =  f"https://{auth}@{ollama}"
```

When you use S3 storage you need the following secrets:
- S3_HOST
- S3_PORT
- S3_ACCESS_KEY
- S3_SECRET_KEY
- S3_BUCKET_DATA

and this initalization code:

```
s3host = args.get("S3_HOST", os.getenv("S3_HOST"))
s3port = args.get("S3_PORT", os.getenv("S3_PORT"))
s3url = f"http://{s3host}:{s3port}"
s3key = args.get("S3_ACCESS_KEY", os.getenv("S3_ACCESS_KEY"))
s3sec = args.get("S3_SECRET_KEY", os.getenv("S3_SECRET_KEY"))
s3store = boto3.client('s3', region_name='us-east-1', endpoint_url=s3url, aws_access_key_id=s3key, aws_secret_access_key=s3sec )
s3bucket =args.get("S3_BUCKET_DATA", os.getenv("S3_BUCKET_DATA"))
```

When you use Milvus you need the following secrets:
- MILVUS_HOST
- MILVUS_DB_NAME
- MILVUS_TOKEN

and this initalization code:

```
uri = f"http://{args.get("MILVUS_HOST", os.getenv("MILVUS_HOST"))}"
token = args.get("MILVUS_TOKEN", os.getenv("MILVUS_TOKEN"))    
db_name = args.get("MILVUS_DB_NAME", os.getenv("MILVUS_DB_NAME"))
vdb = MilvusClient(uri=uri, token=token, db_name=db_name)
``` 

When you use Postgres you need the following secrets:

- POSTGRES_URL

and this initalization code

```
conn = psycopg.connect(args.get("POSTGRES_URL", os.getenv("POSTGRES_URL")))
# rember this
conn.close()
```

